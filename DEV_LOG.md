### 開發日誌：2025年9月11日

**目標：** 建立一個整合 Gemini AI 的網頁客服聊天機器人，並為「凱薩衛浴」客製化客服回答邏輯。

**進度與成果：**

1.  **環境建立與修正：**
    *   建立了基本的 Node.js + Express 伺服器 (`server.js`) 和前端介面 (`index.html`)。
    *   修正了 Gemini API 的 `404 Not Found` 錯誤，原因是模型名稱過時。已將 `gemini-pro` 更新為 `gemini-1.5-flash-latest`，API 連線恢復正常。
    *   再次確認了在 Windows CMD 中設定環境變數 `GEMINI_API_KEY` 的正確方法 (`set GEMINI_API_KEY=YOUR_API_KEY`)。

2.  **客服邏輯架構設計 (方案二)：**
    *   為了應對客戶展示的需求以及未來的可擴充性，我們決定採用一個將「資料」與「邏輯」分離的架構。
    *   **建立了 `knowledge_base.json`**：此檔案作為客服的知識庫，包含兩大部分：
        *   `keywords`: 存放常見問題的「關鍵字」與對應的「罐頭回覆」。這能讓機器人對常見問題做出快速、標準化的回應。
        *   `system_prompt`: 給予 Gemini AI 的「系統提示」或「角色設定」，確保當問題需要 AI 回答時，它的語氣、角色和知識範圍都符合「凱薩衛浴專業客服」的設定。
    *   **更新了 `server.js`**：
        *   在伺服器啟動時，會讀取並解析 `knowledge_base.json`。
        *   當收到使用者訊息時，會先遍歷 `keywords`。如果訊息包含任一關鍵字，則立即回傳預設答案。
        *   如果沒有匹配到任何關鍵字，則會將「系統提示」和「使用者問題」組合後，發送給 Gemini AI 進行處理，並回傳 AI 的答案。

**目前狀態：**

*   系統已可正常運作。
*   能夠針對特定關鍵字 (如：退貨、安裝) 進行快速回覆。
*   對於知識庫以外的問題，能夠以「凱薩衛浴客服」的角色，由 Gemini AI 產生回覆。

**後續建議與討論方向：**

*   **完善 `knowledge_base.json`**：與客戶討論並擴充更多常見的問答到 `keywords` 中。
*   **優化關鍵字比對**：目前是簡單的 `includes` 比對，未來若需求複雜，可研究更精準的自然語言處理 (NLP) 意圖辨識方法。
*   **串接真實資料**：例如，在回答「保固」問題時，可以引導使用者輸入產品型號，後端再去查詢資料庫或檔案，回傳確切的保固期限。
*   **記錄對話歷史**：讓 AI 能夠理解上下文，進行多輪對話。

### 開發日誌：2025年9月12日

**目標：** 將 AI 客服機器人專案部署到線上，使其能透過公開網址訪問。

**進度與成果：**

1.  **部署平台分析：**
    *   討論了將專案部署到 GitHub Pages 的可行性。
    *   結論：不可行。因為專案包含 `server.js` 後端邏輯，而 GitHub Pages 僅支援靜態網站。直接在前端處理會暴露 API 金鑰，有安全風險。
    *   建議使用支援 Node.js 的 PaaS 平台，並選定 Vercel 作為目標平台。

2.  **Vercel 部署準備：**
    *   **建立 `vercel.json`：** 為了讓 Vercel 正確識別 Node.js 伺服器，新增了此設定檔，指導 Vercel 將所有請求都交給 `server.js` 處理。
    *   **建立 `.gitignore`：** 新增此檔案以在上傳至 GitHub 時，自動忽略 `node_modules` 資料夾和臨時腳本，保持倉庫乾淨。
    *   **提供 Git 上傳指令：** 給出了完整的 `git` 指令流程，指導如何初始化本地倉庫、連接到遠端 GitHub 倉庫，並將專案檔案推送上去。

**目前狀態：**
*   專案已具備部署到 Vercel 的所有必要設定檔。
*   已提供將專案上傳到 GitHub 的完整指令。

**後續步驟：**
*   在 GitHub 上建立新倉庫並推送程式碼。
*   在 Vercel 網站上匯入該倉庫，設定環境變數 `GEMINI_API_KEY`，並執行部署。

### 開發日誌：2025年9月12日 (續)

**目標：** 修正 Vercel 部署錯誤，並深入理解 Git 工作流程。

**進度與成果：**

1.  **Vercel 部署偵錯：**
    *   成功將專案部署至 Vercel，但遇到 `500: INTERNAL_SERVER_ERROR` (FUNCTION_INVOCATION_FAILED)。
    *   **根本原因分析：** 透過 Vercel 的日誌 (Logs)，定位到錯誤為 `ENOENT: no such file or directory, open 'knowledge_base.json'`。確認問題是 Vercel 在打包時，未將 `server.js` 動態讀取的 `knowledge_base.json` 包含進去。
    *   **解決方案：** 修改 `server.js`，將讀取方式從 `fs.readFileSync()` 改為 `require('./knowledge_base.json')`。這讓 Vercel 的打包工具能靜態分析出檔案依賴，進而將其正確打包。

2.  **Git 工作流程問題解決：**
    *   在 `git push` 時遇到 `Updates were rejected` 錯誤，原因是遠端倉庫 (GitHub) 的歷史紀錄比本地新 (因在網頁上直接操作)。
    *   透過 `git pull origin main` 指令，先將遠端變更同步至本地，再 `git push`，成功解決問題。

3.  **Git 核心概念討論與學習：**
    *   深入探討了 `git pull` 在本地與遠端同時修改同一檔案時的三種情境：自動合併、合併衝突、因未提交而拒絕。
    *   釐清了 Git 的 `diff` 演算法不依賴「行號」，而是依賴「內容上下文」的區塊 (chunk) 來定位變更，因此能應對單純的增減空行或程式碼位移。
    *   探討了在「上下文」被惡意或意外複製的極端情況下，Git 會因無法解決「歧義」而觸發「合併衝突」，把控制權交還給使用者，以此作為確保程式碼安全的最終防線。

**目前狀態：**
*   AI 客服機器人已在 Vercel 上成功部署並可公開訪問。
*   對於 Git 的核心協作流程有了更深入和準確的理解。